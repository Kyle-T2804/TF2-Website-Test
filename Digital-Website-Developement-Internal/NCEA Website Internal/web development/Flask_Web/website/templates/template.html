<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="theme-color" content="#a73232" />
    <meta name="description" content="TF2 Mercenary Database - Meet the Team Fortress 2 Classes!" />
    <meta name="author" content="TF2Fan" />
    <title>{% block title %}TF2 Mercenary Database{% endblock %}</title>

    <!-- Site Icon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='assets/siteicon.ico.ico') }}" />

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Catamaran:400,700,900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='main.css') }}" />
    {% block head %}{% endblock %}
    <style>
      /* Keep only minimal overrides here */
  #searchSuggestions { z-index: 1500; }

  /* Layout to keep footer at the bottom */
  html, body { height: 100%; }
  body { display: flex; flex-direction: column; min-height: 100vh; }
  .container.mt-4 { flex: 1 0 auto; width: 100%; }

  /* Footer styling + dark mode */
  .app-footer { 
    position: relative; 
    z-index: 1; 
    background: #111; 
    color: #ddd; 
    border-top: 1px solid rgba(255,255,255,0.08);
    transition: background 0.3s ease, color 0.3s ease;
  }
  .theme-dark .app-footer { background: #0f0f10; color: #cfcfcf; border-top-color: #222; }
  .app-footer .footer-text { line-height: 1.45; }

  /* Hide footer when custom modals add this class to body */
  body.modal-open .app-footer { display: none !important; }

  /* Enhanced navbar items */
  .navbar-nav .nav-link {
    position: relative;
    transition: color 0.2s ease;
    padding: 0.5rem 0.8rem;
    border-radius: 6px;
  }
  
  .navbar-nav .nav-link:hover {
    color: var(--bs-primary);
    background-color: rgba(0,0,0,0.04);
    transform: translateY(-1px);
  }
  
  .theme-dark .navbar-nav .nav-link:hover {
    background-color: rgba(255,255,255,0.04);
  }
  
  .navbar-nav .nav-link.active {
    color: #a73232;
    font-weight: 700;
  }
  
  .navbar-nav .nav-link.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0.8rem;
    right: 0.8rem;
    height: 2px;
    background: #a73232;
    border-radius: 2px;
  }
  
  /* Improved dark mode toggle */
  #darkModeToggle {
    transition: all 0.2s ease;
    border-radius: 50%;
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  
  #darkModeToggle:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    background-color: #343a40;
  }
  
  .theme-dark #darkModeToggle {
    background-color: #f8f9fa;
    color: #212529;
  }
  
  .theme-dark #darkModeToggle:hover {
    background-color: #ffffff;
    box-shadow: 0 4px 8px rgba(255,255,255,0.1);
  }
  
  /* Enhanced search bar */
  #searchBar {
    border-radius: 20px;
    transition: all 0.2s ease;
    border: 1px solid #dee2e6;
    padding-left: 1rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
  }
  
  #searchBar:hover {
    border-color: #adb5bd;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  }
  
  #searchBar:focus {
    border-color: #a73232;
    box-shadow: 0 0 0 3px rgba(167,50,50,0.25);
  }
  
  .theme-dark #searchBar {
    background-color: #2a2a2a;
    border-color: #444;
    color: #eee;
  }
  
  .theme-dark #searchBar:hover {
    border-color: #666;
  }
  
  .theme-dark #searchBar:focus {
    border-color: #a73232;
    box-shadow: 0 0 0 3px rgba(167,50,50,0.25);
  }
  
  /* Back to top button enhancement */
  .scroll-to-top {
    position: fixed;
    right: 25px;
    bottom: 25px;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #a73232;
    color: white;
    border-radius: 50%;
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    transition: all 0.3s ease;
    border: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 1000;
  }
  
  .scroll-to-top.is-visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .scroll-to-top:hover {
    background-color: #bf3a3a;
    transform: translateY(-5px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.25);
  }
  
  .scroll-to-top:active {
    transform: translateY(-2px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
  }
  
  .scroll-to-top.avoid-footer {
    bottom: 80px;
  }
  
  /* Progress bar enhancement */
  #progressBar {
    position: fixed;
    top: 0;
    left: 0;
    height: 3px;
    background: linear-gradient(90deg, #a73232, #ff9966);
    z-index: 1060;
    width: 0%;
    transition: width 0.2s ease;
  }
  
  /* Improved toast container */
  #toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1050;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  
  /* Accessibility focus improvements */
  a:focus-visible,
  button:focus-visible,
  input:focus-visible,
  select:focus-visible,
  textarea:focus-visible {
    outline: 2px solid #a73232;
    outline-offset: 2px;
  }
  
  /* Skip to content link for keyboard users */
  .skip-to-content {
    position: absolute;
    left: -9999px;
    top: -9999px;
    z-index: 9999;
    background: #a73232;
    color: white;
    padding: 1rem;
    font-weight: bold;
    border-radius: 0 0 8px 8px;
  }
  
  .skip-to-content:focus {
    left: 50%;
    top: 0;
    transform: translateX(-50%);
  }
  
  /* Toast styling */
  .toast {
    background: white;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    overflow: hidden;
    width: 350px;
    max-width: 100%;
    transition: all 0.3s ease;
  }
  
  .toast-header {
    padding: 0.75rem 1rem;
    background: rgba(0,0,0,0.03);
    border-bottom: 1px solid rgba(0,0,0,0.1);
  }
  
  .toast-body {
    padding: 1rem;
  }
  
  .toast-info .toast-header i {
    color: #0dcaf0;
  }
  
  .toast-success .toast-header i {
    color: #198754;
  }
  
  .toast-warning .toast-header i {
    color: #ffc107;
  }
  
  .toast-error .toast-header i {
    color: #dc3545;
  }
  
  .theme-dark .toast {
    background: #2a2a2a;
    color: #eee;
    box-shadow: 0 5px 15px rgba(0,0,0,0.4);
  }
  
  .theme-dark .toast-header {
    background: rgba(255,255,255,0.05);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    color: #fff;
  }
  
  /* Homepage Animation */
  .homepage-intro {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: #000;
    z-index: 9999;
    opacity: 1;
    visibility: visible;
    transition: opacity 0.5s ease, visibility 0.5s ease;
  }
  
  .homepage-intro.hide {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }
  
  .tf2-logo {
    width: 300px;
    max-width: 80%;
    margin-bottom: 20px;
    transform: scale(0.8);
    opacity: 0;
    animation: logoReveal 2s forwards;
  }
  
  .intro-text {
    color: #f85a3e;
    font-family: 'Catamaran', sans-serif;
    font-weight: 900;
    font-size: 2rem;
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
    opacity: 0;
    transform: translateY(20px);
    animation: textReveal 1.5s 0.8s forwards;
  }
  
  .intro-subtitle {
    color: #ddd;
    font-size: 1.2rem;
    margin-top: 10px;
    opacity: 0;
    transform: translateY(15px);
    animation: textReveal 1.5s 1.2s forwards;
  }
  
  .intro-loader {
    width: 200px;
    height: 4px;
    background: rgba(255,255,255,0.1);
    border-radius: 4px;
    margin-top: 30px;
    overflow: hidden;
    position: relative;
    opacity: 0;
    animation: fadeIn 0.5s 1.5s forwards;
  }
  
  .intro-loader::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, #f85a3e, #ffb347);
    border-radius: 4px;
    animation: loading 2.5s 1.7s forwards;
  }
  
  @keyframes logoReveal {
    0% {
      transform: scale(0.8);
      opacity: 0;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }
  
  @keyframes textReveal {
    0% {
      opacity: 0;
      transform: translateY(20px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes fadeIn {
    to { opacity: 1; }
  }
  
  @keyframes loading {
    0% { width: 0%; }
    60% { width: 80%; }
    100% { width: 100%; }
  }

  /* Add these CSS variables that contact.html depends on */
  :root {
    --bg1: #191a1d;
    --bg2: #1d1e22;
    --bg3: #242529;
    --text: #e6e6e6;
    --surface: #222327;
    --surface-2: #2a2b30;
    --card: #26272c;
    --accent: #1b1b1b;
    --accent-2: #a73232;
    --border: #36373d;
    --shadow-lg: 0 5px 15px rgba(0,0,0,.15);
  }
  
  .theme-dark {
    --bg1: #191a1d;
    --bg2: #1d1e22;
    --bg3: #242529;
    --text: #e6e6e6;
    --surface: #222327;
    --surface-2: #2a2b30;
    --card: #26272c;
    --accent: #1b1b1b;
    --accent-2: #a73232;
    --border: #36373d;
  }

  /* Add these animation keyframes that might be missing */
  @keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes modalSlideIn {
    from { transform: translateY(20px); }
    to { transform: translateY(0); }
  }
  
  @keyframes loading {
    0% { width: 0%; }
    60% { width: 80%; }
    100% { width: 100%; }
  }
  
  @keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
    </style>
    <meta name="baseUrl" content="{{ request.url_root[:-1] }}" />
  </head>

  <body>
    <!-- Add Skip to Content Link for Accessibility -->
    <a href="#content" class="skip-to-content">Skip to content</a>

    <!-- Progress Bar -->
    <div id="progressBar"></div>
    
    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg app-navbar navbar-light" id="navbar">
      <div class="container-fluid">
        <a class="navbar-brand fw-bold d-flex align-items-center" href="/">
          <img src="{{ url_for('static', filename='assets/siteicon.png') }}" alt="Site Icon" width="36" height="36" class="me-2 rounded-circle border border-dark">
          <span class="fs-4">TF2 Mercenary Database</span>
        </a>

        <!-- Dark Mode Toggle -->
        <button class="btn btn-sm btn-dark ms-3" id="darkModeToggle" aria-label="Toggle dark mode" title="Toggle dark mode">
          <i class="fa-solid fa-moon"></i>
        </button>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-center">
            <!-- Search Bar -->
            <li class="nav-item position-relative me-3">
              <input type="text" class="form-control" id="searchBar" placeholder="Search mercs...">
              <ul id="searchSuggestions"></ul>
            </li>

            <li class="nav-item"><a class="nav-link fw-bold {% if request.path == '/home' %}active{% endif %}" href="/home"><i class="fa-solid fa-house"></i> Home</a></li>
            <li class="nav-item"><a class="nav-link fw-bold {% if request.path == '/gallery' %}active{% endif %}" href="/gallery"><i class="fa-solid fa-image"></i> Gallery</a></li>
            <li class="nav-item"><a class="nav-link fw-bold {% if request.path == '/contact' %}active{% endif %}" href="/contact"><i class="fa-solid fa-envelope"></i> Contact</a></li>
            <li class="nav-item"><a class="nav-link fw-bold {% if request.path == '/about' %}active{% endif %}" href="{{ url_for('views.about') }}"><i class="fa-solid fa-circle-info"></i> About</a></li>

            {% if user.is_authenticated %}
              <li class="nav-item"><a class="nav-link fw-bold" href="/logout"><i class="fa-solid fa-right-from-bracket"></i> Logout</a></li>
            {% else %}
              <li class="nav-item"><a class="nav-link fw-bold {% if request.path == '/sign-up' %}active{% endif %}" href="/sign-up"><i class="fa-solid fa-user-plus"></i> Sign Up</a></li>
              <li class="nav-item"><a class="nav-link fw-bold {% if request.path == '/login' %}active{% endif %}" href="/login"><i class="fa-solid fa-right-to-bracket"></i> Login</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Content -->
    <div id="content" class="container mt-4">{% block content %}{% endblock %}</div>

    <!-- Footer -->
    <footer class="app-footer py-3 mt-4">
      <div class="container text-center">
        <p class="m-0 fw-bold footer-text">🛡️ &copy; TF2 Mercenary Database — Created by TF2Fan, 2025 🛡️<br />
        All rights belong to Valve. Fan-made project for educational use.</p>
      </div>
    </footer>
    
    <!-- Back to top button -->
    <button id="backToTop" class="scroll-to-top" aria-label="Back to top">
      <i class="fas fa-arrow-up"></i>
    </button>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Dark mode toggle + persist
      (function () {
        const STORAGE_KEY = 'tf2-theme';
        const btn = document.getElementById('darkModeToggle');
        const root = document.body;

        function apply(theme) {
          const isDark = theme === 'dark';
          root.classList.toggle('theme-dark', isDark);
          if (btn) {
            btn.setAttribute('aria-pressed', String(isDark));
            // ensure an icon exists
            if (!btn.querySelector('i')) btn.innerHTML = '<i class="fa-solid fa-moon"></i>';
            const icon = btn.querySelector('i');
            icon.classList.toggle('fa-sun', isDark);
            icon.classList.toggle('fa-moon', !isDark);
            btn.title = isDark ? 'Switch to light mode' : 'Switch to dark mode';
            btn.setAttribute('aria-label', btn.title);
            btn.dataset.mode = theme;
          }
          const meta = document.querySelector('meta[name="theme-color"]');
          if (meta) meta.setAttribute('content', isDark ? '#111111' : '#a73232');
        }

        function preferred() {
          const saved = localStorage.getItem(STORAGE_KEY);
          if (saved === 'dark' || saved === 'light') return saved;
          return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'dark' : 'light';
        }

        let mode = preferred();
        apply(mode);

        if (btn) {
          btn.addEventListener('click', () => {
            mode = mode === 'dark' ? 'light' : 'dark';
            localStorage.setItem(STORAGE_KEY, mode);
            apply(mode);
          });
        }

        // Follow system if user hasn't chosen
        if (!localStorage.getItem(STORAGE_KEY) && window.matchMedia) {
          window.matchMedia('(prefers-color-scheme: dark)')
            .addEventListener('change', e => { mode = e.matches ? 'dark' : 'light'; apply(mode); });
        }
      })();

      // Back-to-top behavior with improved animation
      (function () {
        const btn = document.getElementById('backToTop');
        if (!btn) return;

        function toggle() {
          const y = window.scrollY || document.documentElement.scrollTop;
          btn.classList.toggle('is-visible', y > 200);

          // keep away from footer
          const footer = document.querySelector('footer.app-footer');
          if (footer) {
            const rect = footer.getBoundingClientRect();
            const winH = window.innerHeight || document.documentElement.clientHeight;
            const overlaps = rect.top < winH - 40;
            btn.classList.toggle('avoid-footer', overlaps);
          }
        }

        window.addEventListener('scroll', toggle, { passive: true });
        window.addEventListener('resize', toggle);
        document.addEventListener('keydown', (e) => {
          if (e.altKey && e.key === 'ArrowUp') window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        btn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
        toggle();
      })();

      // Add scroll progress bar
      (function() {
        const progressBar = document.getElementById('progressBar');
        if (!progressBar) return;
        
        function updateProgress() {
          const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
          const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
          const scrolled = (winScroll / height) * 100;
          progressBar.style.width = scrolled + '%';
        }
        
        window.addEventListener('scroll', updateProgress, { passive: true });
      })();

      // Enhanced toast function
      window.showToast = function(message, type = 'info', duration = 5000) {
        const container = document.getElementById('toast-container');
        if (!container) return;
        
        const toast = document.createElement('div');
        toast.className = `toast show toast-${type}`;
        toast.role = 'alert';
        toast.ariaLive = 'assertive';
        toast.ariaAtomic = 'true';
        
        // Set icon based on type
        let icon = 'info-circle';
        if (type === 'success') icon = 'check-circle';
        if (type === 'error') icon = 'exclamation-triangle';
        if (type === 'warning') icon = 'exclamation-circle';
        
        toast.innerHTML = `
          <div class="toast-header">
            <i class="fas fa-${icon} me-2"></i>
            <strong class="me-auto">${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
          <div class="toast-body">
            ${message}
          </div>
        `;
        
        container.appendChild(toast);
        
        // Add animation
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(20px)';
        toast.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
        
        setTimeout(() => {
          toast.style.opacity = '1';
          toast.style.transform = 'translateX(0)';
        }, 10);
        
        // Auto remove after duration
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transform = 'translateX(20px)';
          setTimeout(() => toast.remove(), 300);
        }, duration);
        
        // Close button functionality
        toast.querySelector('.btn-close').addEventListener('click', () => {
          toast.style.opacity = '0';
          toast.style.transform = 'translateX(20px)';
          setTimeout(() => toast.remove(), 300);
        });
      };

      // Homepage intro animation - simplified and fixed
      (function() {
        // Only run this on homepage
        if (window.location.pathname !== '/' && window.location.pathname !== '/home') return;
        
        // Function to play the animation
        function playIntroAnimation() {
          // Create animation element if it doesn't exist
          let intro = document.getElementById('homepageIntro');
          if (!intro) {
            intro = document.createElement('div');
            intro.id = 'homepageIntro';
            intro.className = 'homepage-intro';
            intro.innerHTML = `
              <img src="${window.location.origin}/static/tf2_logo.png" alt="Team Fortress 2 Logo" class="tf2-logo">
              <div class="intro-text">MERCENARY DATABASE</div>
              <div class="intro-subtitle">Meet the team behind the mayhem</div>
              <div class="intro-loader"></div>
            `;
            document.body.prepend(intro);
            
            // Add skip button
            const skipBtn = document.createElement('button');
            skipBtn.textContent = 'Skip';
            skipBtn.className = 'btn btn-sm position-absolute';
            skipBtn.style = 'bottom: 20px; right: 20px; background: rgba(255,255,255,0.2); color: white;';
            skipBtn.addEventListener('click', () => {
              intro.classList.add('hide');
              setTimeout(() => intro.remove(), 500);
            });
            intro.appendChild(skipBtn);
            
            // Hide after animation completes
            setTimeout(() => {
              intro.classList.add('hide');
              setTimeout(() => intro.remove(), 500);
            }, 4200);
          }
        }
        
        // Play animation on page load if it hasn't played this session
        const hasPlayed = sessionStorage.getItem('tf2IntroPlayed');
        if (!hasPlayed) {
          playIntroAnimation();
          sessionStorage.setItem('tf2IntroPlayed', 'true');
        }
        
        // Make animation replayable when clicking the navbar brand
        document.addEventListener('DOMContentLoaded', () => {
          const navbarBrand = document.querySelector('.navbar-brand');
          if (navbarBrand) {
            navbarBrand.addEventListener('click', function(e) {
              // Check if we're on the home page
              if (window.location.pathname === '/' || window.location.pathname === '/home') {
                e.preventDefault();
                playIntroAnimation();
              }
            });
          }
        });
      })();
    </script>

  {# Page-specific scripts hook #}
  {% block javascript %}{% endblock %}
  </body>
</html>
